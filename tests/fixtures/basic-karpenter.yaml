---
apiVersion: karpenter.sh/v1beta1
kind: Provisioner
metadata:
  name: default-provisioner
spec:
  consolidation:
    enabled: false
  # No ttlSecondsAfterEmpty configured
  requirements:
    # On-demand only
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["on-demand"]
    # Non-Graviton instance types
    - key: node.kubernetes.io/instance-type
      operator: In
      values: ["m5.large", "c5.large"]

---
apiVersion: karpenter.sh/v1beta1
kind: Provisioner
metadata:
  name: spot-graviton-provisioner
spec:
  consolidation:
    enabled: true
  ttlSecondsAfterEmpty: 120
  requirements:
    # Spot enabled
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["spot"]
    # Graviton instance types
    - key: node.kubernetes.io/instance-type
      operator: In
      values: ["c6g.large", "m6g.large"]
    - key: kubernetes.io/arch
      operator: In
      values: ["arm64"]

---
apiVersion: karpenter.sh/v1beta1
kind: Provisioner
metadata:
  name: perf-nodepool
spec:
  consolidation:
    enabled: true
  # No ttlSecondsAfterEmpty -> should trigger MEDIUM TTL issue
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["on-demand"]
    - key: node.kubernetes.io/instance-type
      operator: In
      values: ["m5.large"]

---
apiVersion: karpenter.sh/v1beta1
kind: Provisioner
metadata:
  name: on-demand-nodepool
spec:
  consolidation:
    enabled: false
  ttlSecondsAfterEmpty: 900  # > 600s -> LOW TTL issue
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["on-demand"]
    - key: node.kubernetes.io/instance-type
      operator: In
      values: ["m5a.large"]

---
apiVersion: karpenter.k8s.aws/v1beta1
kind: EC2NodeClass
metadata:
  name: perf-ec2-class
spec:
  # Some reasonably normal selectors, but no instanceProfile â†’ HIGH severity IAM issue
  amiSelectorTerms:
    - id: "ami-0123456789abcdef0"
  subnetSelectorTerms:
    - tags:
        Name: "private-*"
  securityGroupSelectorTerms:
    - tags:
        Name: "eks-node-sg"
  # Intentionally omitted:
  # instanceProfile: "my-eks-node-instance-profile"